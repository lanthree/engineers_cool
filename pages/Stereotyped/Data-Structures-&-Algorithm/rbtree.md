# 红黑树

## 定义

红黑树是一种具有下列着色性质的二叉查找树：

1. 每一个结点或者着红色，或者着黑色
2. 根是黑色的
3. 如果一个结点是红色的，那么它的子结点必须是黑色的
4. 从一个几点到一个NULL指针的每一条路径都必须包含相同数目的黑色结点

一个典型的红黑树如下图所示：

![图1：红黑树的例子](https://engineers-cool-1251518258.cos.ap-chengdu.myqcloud.com/rbtree.svg)

## 插入

首先，考虑插入过程，通常把**新项**作为树叶放到树种（通过二叉查找树找到合适的位置）。然后考虑着色以及平衡的事情。如果把该项涂成黑色，那么在不做其他调整情况下，会违反性质4。如果把该项涂成红色，在父结点是黑色时，插入操作完成，在父结点是红色时，为了不违反性质3，也需要做调整（着色改变 和 树的旋转）。以下以**涂成红色**为例讨论。

?> 感觉涂成黑色也可以？只是当前看到的这个没有讨论？

如果新项（着红色）的父结点是黑色，那么插入完成。如果父结点是红色，那么有以下几种情况（每种都有一个镜像对称）需要考虑。（另外以下讨论中，以NULL为黑色）

### 父结点的兄弟结点是黑色（情况A）

> 以下讨论都，令X是新插入结点，P是父结点，S是该父结点的兄弟结点（若存在），G是祖父结点

如果S结点是黑色（例如在图1中插入8），在这种情况下，只有X和P是红色，G是黑色（G如果不是黑色，那么在插入新结点前，就会有`红G->红P`的违反性质3的情况）。X、P、G可以行政一个**一字型链**或者**之字形链**。下图指出，当P是G的左儿子时，应如何旋转。（还有镜像的P是右儿子的情况，自行想象）

![如果S是黑色，通用的单旋转和之字形旋转有效](https://engineers-cool-1251518258.cos.ap-chengdu.myqcloud.com/rbtree_insert_S_B.svg)

这两种情况下，子树的新根颜色保持不变，不会打破新跟与原子树的父结点的着色约束。另外，新根到A、B、C的叶子上的黑色结点个数保持不变：

1. 情况1：A为空，不讨论；旋转前，G到B经历1个黑色结点，G到C经历2个黑色结点，旋转后 新根到B、C经历的黑色结点个数一样。
2. 情况2：B1、B2为空，不讨论；旋转前，G到A经历1个黑色结点，G到C经历2个黑色结点，旋转后 新根到A、C经历的黑色结点个数一样。

### 父结点的兄弟结点是红色（情况B）

如果S结点是红色（例如在图1中插入79），在这种情况下，X、P、S是红色，G是黑色。此时，从跟结点G到A、B、C只有1个黑结点，在旋转后，我们也希望新根到A、B、C的黑色结点树是1（这样才能保证，新根到A、B、C的叶子的黑色结点数一致）。又由于不能有连续的红色结点，所以S和新根需要是红色，而G和X是黑色：

![如果S是红色，通用的单旋转和之字形旋转 并调整颜色后，新根是红色](https://engineers-cool-1251518258.cos.ap-chengdu.myqcloud.com/rbtree_insert_S_B.svg)

子树是平衡了，但是子树的父结点（R）可能是红色。这时，需要判断结点R的兄弟结点是黑色还是红色，然后重新按上面讨论的 情况A、情况B 处理，直到不再有两个相连的红色结点。

## 删除

1. 要删除的结点，没有子结点，考虑两种情况：
    1. 该结点为红色，直接删除即可。
    2. 该结点为黑色，则需要进行平衡操作，下图展示了这种需要平衡的情况
2. 要删除的结点，有一个子结点。此时，要删除的结点一定是黑色，其子结点一定是红色。那么可以让删除结点的父结点连接到该子结点，并着黑色。
3. 有两个子结点时。与二叉搜索树一样，把 左子结点的最大值/右子结点的最小值 复制到要删除的结点上，把问题转换为删除被复制的结点，递归此过程，直到把问题转换为情况1 或者 情况2。

![删除 黑色 无子结点的结点 的情况]()

> 以上过程，总体上，是把删除结点的问题，归结为删除**最下层子结点**的问题：如果该**最下层子结点**是红色（情况1.1、情况2），那么可以安全的删除。如果该**最下层子结点**是黑色（情况1.2），那需要做平衡操作。

### 平衡操作

约定结点名称如下：

![]()


## 实现

## 参考

1. 《数据结构与算法分析 C++描述》
2. [wikipedia 红黑树](https://zh.wikipedia.org/wiki/%E7%BA%A2%E9%BB%91%E6%A0%91)
3. [彻底理解红黑树（三）之 删除](https://www.jianshu.com/p/84416644c080)